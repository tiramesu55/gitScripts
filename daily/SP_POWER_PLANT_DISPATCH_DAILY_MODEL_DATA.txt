
--truncate table E_SANDBOX.MODEL_DATA.POWER_PLANT_DISPATCH_DAILY
CREATE OR REPLACE PROCEDURE E_SANDBOX.SILVER.SP_POWER_PLANT_DISPATCH_DAILY_MODEL_DATA( DATA_TAG_ID INTEGER)
RETURNS INTEGER
LANGUAGE SQL
EXECUTE AS OWNER
AS
$$
DECLARE

  rows_inserted INTEGER;
BEGIN

INSERT INTO E_SANDBOX.MODEL_DATA.POWER_PLANT_DISPATCH_DAILY

SELECT 
    DATA_TAG_ID,
    POWER_PLANT_ID,
    DATE,
    SUM(GROSS_ENERGY_MARGIN) AS GROSS_ENERGY_MARGIN_SUM,
    SUM(TOTAL_REVENUE) AS TOTAL_REVENUE_SUM,
    SUM(TOTAL_REVENUE_NO_UPLIFT) AS TOTAL_REVENUE_NO_UPLIFT_SUM,
    SUM(ENERGY_REVENUE) AS ENERGY_REVENUE_SUM,
    SUM(ANCILLARY_SERVICES_REVENUE) AS ANCILLARY_SERVICES_REVENUE_SUM,
    SUM(UPLIFT_REVENUE) AS UPLIFT_REVENUE_SUM,
    SUM(SUBSIDY) AS SUBSIDY_SUM,
    SUM(REC_REVENUE) AS REC_REVENUE_SUM,
    SUM(TOTAL_COST) AS TOTAL_COST_SUM,
    SUM(VOM_COST) AS VOM_COST_SUM,
    SUM(FUEL_COST) AS FUEL_COST_SUM,
    SUM(EMISSIONS_COST) AS EMISSIONS_COST_SUM,
    SUM(CAPACITY) as CAPACITY
FROM E_SANDBOX.MODEL_DATA.INJ_DISPATCH_DAILY
WHERE DATA_TAG_ID = :DATA_TAG_ID
GROUP BY DATA_TAG_ID, POWER_PLANT_ID, DATE;

rows_inserted := SQLROWCOUNT;
RETURN  rows_inserted;
END;
$$;

--call E_SANDBOX.SILVER.SP_POWER_PLANT_DISPATCH_DAILY_MODEL_DATA(4)